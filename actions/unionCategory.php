<?phpinclude_once('../config/config.inc.php');//include_once('init.php');include_once ('../autoload.php');set_time_limit(0);class UnionCategory {    public static function getParentId($category) {    }    public static function getCurrentId($category) {    }    public function getParents($id) {        try {            $result = [];            $classCategory = new CategoryCore($id, 1, 1);            $parents = $classCategory->getParentsCategories();            if (!empty($parents)) {                foreach ($parents as $parent) {                    $result[] = $parent['id_category'];                }            }            return $result;        } catch (Exception $e) {            throw new Exception('Error Pars ' . $e->getMessage());        }    }    public static function getCategory($category) {        $result = [];        $arrCategory = explode('/', $category);        $arrCategory = array_reverse($arrCategory);        if (!empty($category)) {            $i = 0;            while ($i < count($arrCategory)) {                $cat = Category::searchByName(1, trim($arrCategory[$i]), true, true);                if ($cat && !empty($cat) && isset($cat['id_category']) && intval($cat['id_category']) > 0) {                    if ($i == 0) {                        $result['parent'][] = $cat['id_category'];                        $result['id'] = $cat['id_category'];                    }                    $result['parent'][] = $cat['id_parent'];                }                $i++;            }        }        return $result;    }}try {    $UnionCategory = new UnionCategory();    $file = __DIR__ . '/category.csv';    $handle = fopen($file, 'r');    $i = 0;    while (($data = fgetcsv($handle, 1000, ';')) !== FALSE) {        if ($data[0] && $data[1]) {            //echo $data[0] . "\n";            //sleep(1);            $toId = UnionCategory::getCategory($data[0]);            $validateToId = $UnionCategory::getParents($toId['id']);            if ($toId['parent'] == $validateToId) {                $fromId = UnionCategory::getCategory($data[1]);                //print_r($fromId);                //print_r($toId);                $products = Db::getInstance()->executeS(                    'SELECT `id_product` ' .                    'FROM `' . _DB_PREFIX_ . 'category_product` ' .                    'WHERE `id_category` = ' . (int) $fromId['id'] . '  ' .                    'ORDER BY `position`'                );                if (!empty($products)) {                    foreach ($products as $product) {                        Db::getInstance()->delete('category_product', 'id_product = ' . (int) $product['id_product'] . ' AND id_category = ' . (int) $fromId['id']);                        Db::getInstance()->execute('INSERT INTO `' . _DB_PREFIX_ . 'category_product` (`id_product`, `id_category`, `position`) VALUES (' . (int) $product['id_product'] . ', ' . (int) $toId['id'] . ', 0)');                    }                }            }            //$fromId = UnionCategory::getCategoryId($data[1]);            //$categories[] = $data;        }        $i++;    }    echo 'обработано ' . $i . ' категорий';} catch (Exception $e) {    echo $e->getMessage();}//print_r($categories);